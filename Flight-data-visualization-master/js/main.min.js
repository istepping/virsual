//启用严格模式
"use strict";let doc=document;let sys={getel:function(o){return doc.querySelectorAll(o)},vm:function(obj,attr,fun,boolean){if(boolean==undefined){boolean=true}let old=obj[attr];Object.defineProperty(obj,attr,{set:function(data){let bool=false;if(data==old){fun(data,bool);console.log("重新赋值了,但未发生变化")}else{bool=true;fun(data,bool)}},configurable:boolean})},setStyle:function(el,strCss,boolean){let oEl=doc.querySelectorAll(el);let length=oEl.length;for(let i=0;i<length;i+=1){if(typeof arguments[2]=="undefined"||arguments[2]==false){oEl[i].style.cssText+=strCss}else{oEl[i].style.cssText=strCss}}},request:function(type,url,senddata,success,err){if(window.XMLHttpRequest){var oAjax=new XMLHttpRequest()}else{var oAjax=new ActiveXObject("Microsoft.XMLHTTP")}if(arguments[0]=='get'){url+='?'+senddata;oAjax.open(type,url,true);oAjax.send()}else if(arguments[0]=='post'){oAjax.open(type,url,true);oAjax.setRequestHeader('Cache-Control','max-age=3053600');oAjax.send(senddata)}oAjax.onreadystatechange=function(){if(oAjax.readyState==4){if(oAjax.status==200){success(oAjax.responseText)}else{err(oAjax.status);console.log('失败了:'+oAjax.status)}}}}};sys.mySave={save:function(key,value){localStorage.setItem(key,JSON.stringify(value))},getsave:function(key){return JSON.parse(localStorage.getItem(key))||[];}};let indexDB={set:function(key,value,success,funErr){localforage.setItem(key,value,function(err,value){if(err){console.log("存储出现错误:"+err);console.dir(err);if(funErr){funErr(err)}else{}}else{success(value)}})},get:function(key,success,errNull){localforage.getItem(key,function(err,value){if(err){console.log("取值出现错误:"+err)}else{if(value){success(value)}else{if(errNull){errNull(value)}else{}console.log('取值:value为空或错误')}}})}};sys.worker=function(src,sendData,callBack){let webWorker=new Worker(`./js/webworker/${ src }`);webWorker.postMessage(sendData);webWorker.onmessage=function(e){callBack(e)};webWorker.onerror=function(error){console.log("Worker地址"+src+"错误:"+error.message,error.filename,error.lineno)}};let requestArg={cityName:"成都市"};let setUp={};if(sys.mySave.getsave('setUp')==''){setUp={linesAnimation:true,oliAnimation:true,linesHightColor:'#00F5FF',saveImageType:'png',timeLineDelay:2000,countryTop:10};sys.mySave.save('setUp',setUp)}else{setUp=sys.mySave.getsave('setUp');};let Memo={timer:null,dom:sys.getel("#side_text")[0],subDom:sys.getel("#side_title_sub")[0],i:0};Memo.dom.value=sys.mySave.getsave('MemoText');Memo.dom.addEventListener('input',function(){clearTimeout(Memo.timer);Memo.timer=setTimeout(function(){sys.mySave.save('MemoText',Memo.dom.value);Memo.i+=1;Memo.subDom.innerText='已为您自动保存'+Memo.i+'次';console.log('保存成功')},1500)});let optionMap=echarts.init(sys.getel("#optionMap")[0]);let charts=sys.getel("[chart]");let map=echarts.init(charts[3]);let c1=echarts.init(charts[0]);let c2=echarts.init(charts[1]);let c3=echarts.init(charts[2]);let c5=echarts.init(charts[4]);let c7=echarts.init(charts[5]);let c9=echarts.init(charts[7]);let secondXy=echarts.init(sys.getel("#secondPageMapXy")[0]);let aHighlightEd=[];sys.clearHightLines=function(){for(let i=0;i<aHighlightEd.length;i+=1){map.dispatchAction({type:'downplay',seriesIndex:[0,1],dataIndex:aHighlightEd[i]})};for(let i2=0;i2<aHighlightEd.length;i2+=1){map.dispatchAction({type:'highlight',seriesIndex:[0,1],dataIndex:aHighlightEd[i2]})}};let tool={};tool.FunPopup=function(title,body){this.oPopup=sys.getel("#popup_border")[0];this.oTitle=this.oPopup.querySelector("#popup_title");this.oBodySpan=this.oPopup.querySelector("#popup_body span");this.oBody=this.oPopup.querySelector("#popup_body");this.oMask=sys.getel("#popup_mask")[0];this.oBtnTrue=this.oPopup.querySelector("#popup_true");this.oBtnFalse=this.oPopup.querySelector("#popup_false");this.oTitle.innerHTML=title;this.oBodySpan.innerHTML=body;this.state};tool.FunPopup.prototype.close=function(fun){this.oMask.style.zIndex="-1";this.oPopup.style.transform="perspective(600px) scale(0)";this.oPopup.style.opacity="0";this.oBody.className=''};tool.FunPopup.prototype.open=function(fun){let _this=this;this.oMask.style.zIndex="999";this.oPopup.style.transform="perspective(600px) scale(1)";this.oPopup.style.opacity="1";this.oBody.className='popup_body_type';this.oPopup.style.boxShadow="0px 0px 0px 100vw rgba(0,0,0,0.7)";this.oBtnTrue.onclick=function(){_this.state=true;_this.oPopup.style.boxShadow="none";_this.close();fun()};this.oBtnFalse.onclick=function(){_this.state=false;_this.oPopup.style.boxShadow="none";_this.close()}};tool.sideBar=function(){let btn=sys.getel(".fa-list-ul")[0];let oSideBar=sys.getel("#sideBar")[0];let box=sys.getel("#box")[0];let btn_old_class=btn.className;btn.onclick=function(event){event.stopPropagation();if(sys.getel(".active-list-ui")[0]){btn.className=btn_old_class;box.style.transform="translate3d(0px,0px,0px)";oSideBar.style.transform="perspective(600px) rotateY(90deg)"}else{btn.className=btn_old_class+" active-list-ui";oSideBar.style.transform="rotateY(0deg)";box.style.transform="translate3d(-3.5rem,0px,0px)"}}};tool.fullScreen=function(id){const btn=sys.getel(id)[0];let oldClass=btn.className;let newClass="fa fa-compress";function fullscreenChange(){let eventChangName=["fullscreenchange","msfullscreenchange","webkitfullscreenchange","mozfullscreenchange"];eventChangName.forEach(function(item,index){if(item){doc.addEventListener(item,function(){let bool=true;let fullscreenState=[doc.fullscreenElement,doc.mozFullScreen,doc.msFullscreenElement,doc.webkitIsFullScreen];fullscreenState.forEach(function(Item,Index){if(Item){btn.className=newClass}else if(Item==false){btn.className=oldClass;charts[2].style.height='2rem';charts[4].style.height='2rem';c3.resize();c5.resize()}else if(Item==undefined){}})},false)}})};function fun_full(){if(btn.className==oldClass){const docElm=doc.documentElement;if(docElm.requestFullscreen){docElm.requestFullscreen()}else if(docElm.msRequestFullscreen){docElm.msRequestFullscreen()}else if(docElm.mozRequestFullScreen){docElm.mozRequestFullScreen()}else if(docElm.webkitRequestFullScreen){docElm.webkitRequestFullScreen()}charts[2].style.height='3.25rem';charts[4].style.height='3.25rem';c3.resize();c5.resize()}else{if(doc.exitFullscreen){doc.exitFullscreen()}else if(doc.msExitFullscreen){document.msExitFullscreen()}else if(doc.mozCancelFullScreen){document.mozCancelFullScreen()}else if(doc.webkitCancelFullScreen){doc.webkitCancelFullScreen()}};fullscreenChange();};btn.addEventListener("click",fun_full,false);doc.onkeydown=function(e){let eVent=e||event;if(eVent.keyCode==122){eVent.preventDefault();fun_full()}else if(btn.className==oldClass&&eVent.keyCode!=27&&eVent.keyCode!=122){fun_full()}};doc.addEventListener('click',function(e){if(btn.className==oldClass){fun_full()}});};tool.menu=function(){let btnLanguage=sys.getel("[tool=language]")[0];btnLanguage.addEventListener('click',function(){layui.use('layer',function(){var layer=layui.layer;layer.open({area:['9rem','5rem'],type:2,shade:0,content:['http://fanyi.baidu.com','no']})})});let oMenu=sys.getel("#menu")[0];let oMenuChild=oMenu.querySelectorAll("[menu]");let oMenuChildLength=oMenuChild.length;let oMenuComputedWidth=parseInt(getComputedStyle(oMenu).width);let oMenuComputedHeight=parseInt(getComputedStyle(oMenu).height);let echartFullscreenState=false;doc.oncontextmenu=function(e){let eVent=e||event;oMenu.style.cssText+='display:block';if(!echartFullscreenState){for(let i=0;i<oMenuChildLength;i+=1){oMenuChild[i].style.display="block"}}let oAttrValue=eVent.target.parentNode.parentNode.getAttribute("chart");let oAttrNode=eVent.target.parentNode.parentNode;switch(oAttrValue){case "1":console.log("冒泡到1");break;case "2":console.log("冒泡到2");break;case "3":console.log("冒泡到3");break;case "4":console.log("冒泡到4");break;case "5":console.log("冒泡到5");break;case "6":console.log("冒泡到6");break;case "7":console.log("冒泡到7");break;case "8":console.log("冒泡到8");break;case "9":if(c9.getOption().series[0].name=='shuiqiu'){sys.getel("[menu=fullChart]")[0].style.display="none"}else{sys.getel("[menu=fullChart]")[0].style.display="block"}console.log("冒泡到9");break;case "info":console.log("冒泡到10");break;default:sys.getel("[menu=fullChart]")[0].style.display="none";break}oMenuComputedWidth=parseInt(getComputedStyle(oMenu).width);oMenuComputedHeight=parseInt(getComputedStyle(oMenu).height);let x=eVent.clientX>innerWidth-oMenuComputedWidth?eVent.clientX-oMenuComputedWidth:eVent.clientX;let y=eVent.clientY>innerHeight-oMenuComputedHeight?eVent.clientY-oMenuComputedHeight:eVent.clientY;oMenu.style.cssText+=`left:${ x }px;top:${ y }px;`;oMenu.onclick=function(e){let Example=[c1,c2,c3,map,c5,c7,c9];let oBtnBack=sys.getel("[tool=back]")[0];let ExampleArgs;function echartFullscreen(obj){if(c7.getDom()==obj){c7.setOption({series:[{name:'城市词云',sizeRange:[20,60],gridSize:8}]})}if(c9.getDom()==obj){c9.setOption({grid:{right:60,top:50,bottom:20,width:'95%',containLabel:true}})}echartFullscreenState=true;sys.getel("#search")[0].className="";let oldStyle=obj.style.cssText;for(let i=0;i<charts.length;i+=1){charts[i].style.display="none";sys.getel("#chartSum3")[0].style.display="none";}obj.style.cssText="display:block;width:15.2rem;border:none;background:none;height:7.8rem ;position:absolute;left:0px;top:0rem;margin:0;padding:0;z-index:1";let objAttr=obj.getAttribute("chart");console.log(objAttr);let clearEchart=function(debar){for(let i=0;i<Example.length;i+=1){if(Example[i]==debar){ExampleArgs=Example[i]}else{if(Example[i]!=c5&&Example[i]!=c7){}}};};oBtnBack.style.display="block";oBtnBack.onclick=function(){sys.getel("[tool=search]")[0].style.display="block";echartFullscreenState=false;for(let i=0;i<charts.length;i+=1){charts[i].style.display="block";sys.getel("#chartSum3")[0].style.display="block";}this.style.display="none";obj.style.cssText=oldStyle;ExampleArgs.resize();console.log(ExampleArgs);if(ExampleArgs==c7){c7.setOption({series:[{name:'城市词云',sizeRange:[8,30],gridSize:2}]})}else if(ExampleArgs==c9){c9.setOption({grid:{left:-5,right:50,top:50,bottom:5,width:'91%',containLabel:true}})}sys.getel("[menu=fullChart]")[0].style.display="block";sys.clearHightLines()};switch(objAttr){case "1":clearEchart(Example[0]);c1.resize();break;case "2":clearEchart(Example[1]);c2.resize();break;case "3":clearEchart(Example[2]);c3.resize();break;case "4":clearEchart(Example[3]);map.resize();sys.clearHightLines();break;case "5":clearEchart(Example[4]);c5.resize();break;case "6":break;case "7":clearEchart(Example[5]);c7.resize();break;case "8":break;case "9":clearEchart(Example[6]);c9.resize();break;default:console.log("这不是图表");break}}let eVent=e||event;let oMenuEvent=eVent.target;let oMenuEventAttr=oMenuEvent.getAttribute("menu");let oMenuEventParentAttr=oMenuEvent.parentNode.getAttribute("menu");let eventNode=oMenuEventAttr||oMenuEventParentAttr;switch(eventNode){case "fullChart":sys.getel("[menu=fullChart]")[0].style.display="none";setTimeout(function(){echartFullscreen(oAttrNode)},1);break;case "refresh":window.location.reload();break;case "saveImage":let instance=echarts.getInstanceByDom(oAttrNode);let base64=instance.getDataURL({type:setUp.saveImageType,pixelRatio:3});let a=doc.createElement('a');a.setAttribute('href',base64);a.setAttribute('download','星云航班数据可视化');a.click();break;case "back":history.back();break;case "go":history.forward();break;case "info":break;case "view-source":let source=sys.getel("#view-source")[0];source.style.display='block';source.innerHTML=document.documentElement.outerHTML;source.addEventListener('click',function(){if(source.innerHTML!=''){source.style.display='none'}});layui.use('code',function(){layui.code({elem:'#view-source',title:'部分前端源码ヾ(◍°∇°◍)ﾉﾞ其他的秘密不给看,只给html',encode:true,skin:'notepad',about:false});});sys.getel("#view-source")[0].style.transform="translateY(100vh)";break;default:return false;break}};return false;};doc.addEventListener('click',function(){oMenu.style.display="none";sys.getel("#about")[0].style.transform="rotateZ(0deg) scale(0)"})};tool.search=function(){let singleTimeMo="2018-2-1";let searchDateInput=sys.getel("#searchDate")[0];let input=sys.getel("#searchInput")[0];searchDateInput.addEventListener('click',function(e){input.focus()});let singleValue=singleTimeMo.replace(/-/gim,'/');requestArg.singleTime=Date.parse(new Date(singleValue))/1000;layui.use('laydate',function(){let layuidate=layui.laydate;layuidate.render({elem:'#searchDate',range:true,value:'2018-2-3 - 2018-2-6',min:'2018-2-1',max:'2018-5-1',theme:'#0084FF',done:function(value,date,endDate){let arrValue=value.split(" - ");arrValue[0]=arrValue[0].replace(/-/gim,'/');arrValue[1]=arrValue[1].replace(/-/gim,'/');requestArg.startTime=Date.parse(new Date(arrValue[0]))/1000;requestArg.endTime=Date.parse(new Date(arrValue[1]))/1000;if(requestArg.startTime==requestArg.endTime){requestArg.endTime=requestArg.startTime+86400;}if(requestArg.endTime-requestArg.startTime<0){let pop=new tool.FunPopup("星云提醒","结束时间小于开始时间哦");pop.open(function(){})}else if((requestArg.endTime-requestArg.startTime)/86400>=10){let pop=new tool.FunPopup("星云温馨提醒","您查询的时间超过10天,数据量较大,第一次加载可能较慢");pop.open(function(){})}console.log(requestArg.startTime);console.log(requestArg.endTime);input.focus()}})});layui.use('laydate',function(){let layuidate=layui.laydate;layuidate.render({elem:'#searchSingleDate',range:false,value:'2018-2-1',min:'2018-2-1',max:'2018-5-1',btns:['clear','confirm'],theme:'#0084FF',done:function(value,date,endDate){let arrValue=value.replace(/-/gim,'/');requestArg.singleTime=Date.parse(new Date(arrValue))/1000;input.focus()}})});function timeUnix(){this.value=this.value.replace(/[>_<(?~？！){。\\}、\+%&$^@!=+\`\",.:*]/gim,'');let arrValue=this.value.split(" - ");arrValue[0]=arrValue[0].replace(/-/gim,'/');arrValue[1]=arrValue[1].replace(/-/gim,'/');requestArg.startTime=Date.parse(new Date(arrValue[0]))/1000;requestArg.endTime=Date.parse(new Date(arrValue[1]))/1000;console.log(requestArg.startTime);console.log(requestArg.endTime);console.log(requestArg.endTime-requestArg.startTime);if(requestArg.endTime-requestArg.startTime<0){let pop=new tool.FunPopup("系统警告","结束时间小于开始时间");pop.open(function(){})}}timeUnix.apply(searchDateInput,[]);searchDateInput.oninput=function(){timeUnix.apply(searchDateInput,[])};let search_title=sys.getel("#search_title")[0];let search=sys.getel("#search")[0];let search_result_box=sys.getel("#search_result_box")[0];search_result_box.addEventListener("mousedown",function(e){e.preventDefault()});sys.getel("#search #search_select")[0].addEventListener("mousedown",function(e){e.preventDefault()});let searchInput=sys.getel("#searchInput")[0];let btnSearch=sys.getel("[tool=search]")[0];btnSearch.addEventListener("click",function(){if(search.className=="search_show"){return false}else{search.className="search_show"}searchInput.focus()});let btnSearchClose=sys.getel("#search .fa-close")[0];btnSearchClose.addEventListener('click',function(){search.className="";search_result_box.style.transform="scale(0)"});searchInput.addEventListener("focus",function(){search_result_box.style.transform="scale(1)"});searchInput.addEventListener("blur",function(){search_result_box.style.transform="scale(0)"});let searchStyle=search.style;let deviationX=0,deviationY=0,sumx=0,sumy=0;let stateDeviationX=0;let state=true;search_title.onmousedown=function(e){if(state){sumx+=deviationX;sumy+=deviationY;state=false;}let ev=e||event;let oldClint={sx:ev.clientX,sy:ev.clientY};let youX=sumx-oldClint.sx;let youY=sumy-oldClint.sy;doc.onmousemove=function(e){state=true;let eMove=e||event;let nowClintX=eMove.clientX;let nowClintY=eMove.clientY;if(eMove.clientX>=innerWidth-20){nowClintX=innerWidth-20}else if(eMove.clientX<=20){nowClintX=20}if(eMove.clientY>=innerHeight-20){nowClintY=innerHeight-20}else if(eMove.clientY<=20){nowClintY=20}searchStyle.transform=`translateX(${nowClintX+youX }px) translateY(${nowClintY+youY }px)`;deviationX=nowClintX-oldClint.sx;deviationY=nowClintY-oldClint.sy}};doc.onmouseup=function(){doc.onmousemove=null};(function(){requestArg.type="城市名";let select=sys.getel("#search #search_select")[0];let selectName=sys.getel("[selectName]");let state=false;let selectNameLength=selectName.length;let searchDate=sys.getel("#searchDate")[0];let searchSingleDate=sys.getel("#searchSingleDate")[0];for(let IselectList=0;IselectList<selectNameLength;IselectList+=1){selectName[IselectList].addEventListener('click',function(e){if(state==false){let deviationY=0.42;state=true;for(let i=0;i<selectNameLength;i+=1){switch(getComputedStyle(selectName[i]).zIndex){case "3":selectName[i].removeAttribute("class");selectName[i].className="selectZindex3Animation";break;case "2":selectName[i].style.transform="translateY("+deviationY+"rem)";break;case "1":selectName[i].style.transform="translateY("+deviationY*2+"rem)";break;default:console.log(getComputedStyle(selectName[i]).zIndex+":异常");break}}}else{state=false;let activity=this;let selectName3;for(let i2=0;i2<selectName.length;i2+=1){selectName[i2].style.transform="translateY(0)";selectName[i2].className="";if(getComputedStyle(selectName[i2]).zIndex=="3"){selectName3=selectName[i2];}}activity.style.zIndex=getComputedStyle(selectName3).zIndex;activity.style.top=getComputedStyle(selectName3).top;selectName3.style.zIndex=getComputedStyle(activity).zIndex;selectName3.style.top=getComputedStyle(activity).top;requestArg.type=activity.innerText;if(requestArg.type=="城市名"){searchDate.style.display='inline-block';searchSingleDate.style.display='none'}else if(requestArg.type=="航班号"){searchDate.style.display='none';searchSingleDate.style.display='inline-block'}else if(requestArg.type=="国家名"){requestArg.type="城市名";location.hash='#optionMapPage';sys.getel("#search")[0].className='';sys.getel('[tool=optionCounty]')[0].click()}console.log("ajax参数"+requestArg.type)}})}})()};(function(){let indexPage=sys.getel("#indexView")[0];let secondPage=sys.getel("#secondPage")[0];let chart=sys.getel("#chart")[0];let toolSwitch=sys.getel("[tool=switch]")[0];let info=sys.getel("#info")[0];let toolThreeStyle=sys.getel("[tool=language],[tool=help],[tool=chat]");let toolBackStyle=sys.getel("[tool=back]")[0];toolSwitch.addEventListener('click',function(){if(sys.getel(".secondPageAnimationClose")[0]){info.style.opacity='0';indexPage.style.opacity="0";secondPage.className="secondPageAnimationOpen"}else{info.style.opacity='1';indexPage.style.opacity="1";secondPage.className="secondPageAnimationClose"}},false);if(sys.mySave.getsave('useCount')!=''){window.useCount=localStorage.getItem('useCount')}else{}toolThreeStyle[1].addEventListener('click',function(){welcome.style.display='block'});function checkHash(){let optionTool=sys.getel("#optionTool")[0];switch(location.hash){case "#indexPage":chart.className="indexPageAnimation";toolSwitch.style.display="block";optionTool.style.display='none';toolThreeStyle[0].style.right='1.78rem';toolThreeStyle[1].style.right='2.15rem';toolThreeStyle[2].style.right='2.55rem';toolBackStyle.style.right='3rem';break;case "#optionMapPage":chart.className="optionMapPageAnimation";toolSwitch.style.display="none";optionTool.style.display='inline-block';toolThreeStyle[0].style.right='1.35rem';toolThreeStyle[1].style.right='1.7rem';toolThreeStyle[2].style.right='2.1rem';toolBackStyle.style.right='2.5rem';break;default:optionTool.style.display='none';break}};checkHash();window.addEventListener("hashchange",function(e){checkHash();},false);let search=sys.getel("#search")[0];let searchInput=sys.getel("#searchInput")[0];let chat_input=sys.getel('#chat_input')[0];let side_text=sys.getel('#side_text')[0];doc.addEventListener("keydown",function(eDown){if(eDown.keyCode==37){doc.addEventListener("keyup",function(eUp){if(eUp.keyCode==37){if(searchInput==doc.activeElement||chat_input==doc.activeElement||side_text==doc.activeElement){}else{location.hash="#optionMapPage"}}})}else if(eDown.keyCode==39){doc.addEventListener("keyup",function(eUp){if(eUp.keyCode==39){if(searchInput==doc.activeElement||chat_input==doc.activeElement||side_text==doc.activeElement){}else{location.hash="#indexPage"}}})}else if(eDown.keyCode==17){doc.addEventListener("keydown",function(eUp){if(eUp.keyCode==70){eUp.preventDefault();eUp.stopPropagation();if(search.className=="search_show"){return false;}else{if(sys.getel("[tool=search]")[0].style.display=="none"){return false}else{search.className="search_show"}}searchInput.focus()}})}else if(eDown.keyCode==40){doc.addEventListener("keyup",function(eUp){if(eUp.keyCode==40){indexPage.style.opacity="1";secondPage.className="secondPageAnimationClose"}})}else if(eDown.keyCode==38){doc.addEventListener("keyup",function(eUp){if(eUp.keyCode==38){indexPage.style.opacity="0";secondPage.className="secondPageAnimationOpen"}})}else if(eDown.keyCode==9){eDown.preventDefault();return false}})})();window.onload=function(){tool.sideBar();tool.fullScreen("[tool=FullScreen]");tool.menu();tool.search();let planePath='path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z';let series=[];series.push({type:"effectScatter",name:"hightScatter",geoIndex:0,zlevel:7,animation:true,coordinateSystem:"geo",symbol:"circle",symbolSize:12,label:{normal:{show:true,position:'right',formatter:'{b}'}},itemStyle:{normal:{color:'rgba(0,245,255,1)'}},data:[]},{name:'航线',type:'lines',zlevel:5,animation:true,blendMode:"lighter",polyline:false,large:true,symbol:['none','arrow'],symbolSize:6,effect:{show:true,period:10,trailLength:0,symbol:planePath,symbolSize:10,color:"rgba(0,245,255,1)"},lineStyle:{normal:{color:"rgba(100,149,237,1)",width:1.5,opacity:1,curveness:0.3},emphasis:{width:2,opacity:1,color:"rgba(0,245,255,1)"}},},{name:'城市',geoIndex:0,zlevel:6,type:'scatter',coordinateSystem:'geo',showEffectOn:'emphasis',symbol:'circle',label:{normal:{show:false,}},hoverAnimation:true,legendHoverLink:true,symbolSize:7,itemStyle:{normal:{color:"#7FFF00"},emphasis:{color:"rgba(0,245,255,1)"}},data:null},{name:'延误',type:'lines',zlevel:4,animation:true,polyline:false,large:true,symbol:['none','arrow'],legendHoverLink:true,symbolSize:0,effect:{show:false,period:0,trailLength:0,symbol:'none'},lineStyle:{normal:{color:"rgba(255,255,0,1)",width:1,opacity:1,curveness:0.35}},data:[]},{name:'取消',type:'lines',hoverAnimation:true,legendHoverLink:true,symbolSize:7,lineStyle:{normal:{width:2.5,color:"rgba(255,0,0,1)"},emphasis:{width:3,color:"rgba(255,255,255,1)"}},data:[]});let option={title:{text:'航线视图',subtext:'',left:'center',textStyle:{color:'#fff'}},toolbox:{show:true,showTitle:true,feature:{restore:{},}},tooltip:{trigger:'item',formatter:function(params){let returnValue="空";if(location.hash=="#indexPage"){if(params.seriesType=="scatter"||params.seriesType=="effectScatter"){return params.name}else if(params.seriesType=="lines"){return params.data.fromName+'>'+params.data.toName+"</br>航班数:"+params.data.value+"架次"}}else{if(params.seriesType=="scatter"||params.seriesType=="effectScatter"){if(params.value[2]){if(params.value[3]){return "城市名:"+params.name+"</br>月均起降:"+params.value[2]+"架次</br>"+params.value[3]}else{return "城市名:"+params.name+"</br>月均起降:"+params.value[2]+"架次</br>机场名加载中"}}else{params.value[2]=0;if(params.value[3]){return params.name+"</br>月均起降:暂无数据</br>"+params.value[3]}else{return params.name+"</br>月均起降:暂无数据</br>机场名加载中"}}}else if(params.seriesType=="lines"){return params.data.fromName+'>'+params.data.toName+"</br>"}}}},geo:{map:'world',geoIndex:0,zoom:1.2,center:[0,20],label:{emphasis:{show:true}},roam:true,itemStyle:{normal:{borderWidth:0.2,areaColor:'rgb(12,97,156)',borderColor:'#404a59'},emphasis:{borderColor:'rgba(0,0,0,0.2)',areaColor:'rgba(0,0,0,0.2)'}},nameMap:{'China':'中国'}},legend:{orient:'vertical',top:'bottom',left:'right',data:['城市','航线','延误','取消'],textStyle:{color:'rgba(0,245,255,1)'},selected:{'取消':false,'延误':false},selectedMode:'multiple',inactiveColor:'rgba(100,100,100,1)'},series:series};let pieOption={color:['#2ae0c8','rgba(0,245,255,0.5)','rgba(0,255,150,1)','#fbb8ac','#acf6ef','#fad8be','#cbf5fb','#bdf3d4','#e3c887','#e6e2c3'],textStyle:{color:'rgba(0,245,255,1)',fontWeight:'lighter'},title:{left:'center',top:10,textStyle:{color:'rgba(0,245,255,0.8)',fontSize:14}},tooltip:{trigger:'item',formatter:"{a} <br/>{b} : {c} ({d}%)<br/>"},legend:{name:'国家图例',type:'scroll',orient:'vertical',top:'bottom',left:'right',formatter:function(name){return echarts.format.truncateText(name,60,'10px Microsoft Yahei');},tooltip:{show:true},textStyle:{color:'rgba(0,245,255,1)',fontSize:10},selectedMode:'multiple',inactiveColor:'rgba(100,100,100,1)'},series:[{id:"pie",name:'来往国家',type:'pie',radius:[0,"80%"],center:['42%','50%'],hoverAnimation:true,data:[],selectedMode:true,minAngle:5,cursor:"pointer",roseType:'radius',label:{normal:{color:'rgba(0, 245, 255, 0.6)'},emphasis:{color:'rgba(0, 255, 255, 1)',fontWeight:"bold"}},labelLine:{normal:{lineStyle:{color:'rgba(255, 255, 255, 0.3)'},smooth:0,length:6,length2:6}},itemStyle:{normal:{borderWidth:1,shadowBlur:10,borderColor:new echarts.graphic.LinearGradient(0,0,1,1,[{offset:0,color:'rgba(0,245,255,1)'},{offset:1,color:'#70ffac'}]),shadowColor:'rgba(142, 152, 241, 0.6)'},emphasis:{color:'rgba(0,255,255,1)'}},animationType:'scale',animationEasing:'elasticOut',animationDelay:function(idx){return Math.random()*1000}}]};let airLineOption={title:{x:'center',text:'相关航司信息',textStyle:{fontSize:14,color:'rgba(0,245,255,0.7)'}},color:['red','green','white','black','blue','yellow','#d622ec','#ed45df','#fdffdb','#49c1bf'],legend:{type:'scroll',data:['上海','广州','北京123456789','纽约'],left:'right',orient:'vertical',selectedMode:'multiple',formatter:function(name){return echarts.format.truncateText(name,60,'10px Microsoft Yahei');},textStyle:{color:'rgba(0,245,255,1)',fontSize:10},inactiveColor:'rgba(100,100,100,1)',tooltip:{show:true}},tooltip:{show:true,trigger:'item',formatter:"加油"},realtime:false,parallelAxis:[{dim:0,name:'经营规模'},{dim:1,name:'延误数'},{dim:2,name:'准点率(%)'},{dim:3,name:'延误时长(分)',}],parallel:{left:30,bottom:'9%',top:"10%",right:85,width:'auto',parallelAxisDefault:{type:'value',nameLocation:'start',nameGap:8,triggerEvent:true,nameTextStyle:{color:'rgba(0,245,255,0.8)'},axisLine:{lineStyle:{color:'rgba(0,245,255,0.8)',width:2}}}},series:[{smooth:true,name:'北京123456789',type:'parallel',data:[[1,0.05,9,1],[2,0.69,11,1]]},{name:'上海',type:'parallel',lineStyle:{color:'black'},data:[[3,0.9,7,0.1],[4,0.78,7,0.5]]},{name:'广州',type:'parallel',lineStyle:{},data:[[4,0.9,7,0.6],[5,0.1,24,0.9]]},{name:'纽约',type:'parallel',lineStyle:{},data:[[4,0,158,0.6],[5,0.9,214,0.9]]}]};var itemStyle={normal:{color:new echarts.graphic.LinearGradient(0,1,0,0,[{offset:0,color:'#2af598'},{offset:1,color:'#009efd'}]),barBorderRadius:8},emphasis:{color:new echarts.graphic.LinearGradient(0,1,0,0,[{offset:0,color:'rgba(0,245,255,1)'},{offset:1,color:'red'}]),barBorderRadius:4}};let timeData=[];let timedatadata=[];for(var n=0;n<1;n+=1){timeData.push({title:{left:'center',show:true,subtext:"2月3日 ~ 2月-6日 成都市航班概览 ",textStyle:{color:'rgba(0,245,255,1)'}},tooltip:{trigger:'axis'},calculable:true,grid:{botom:0,left:'5%',width:"60%"},xAxis:[{type:'category',textStyle:{color:'rgba(0,245,255,1)'},axisLabel:{color:'rgba(0,245,255,1)',interval:0,rotate:0},}],yAxis:[{type:'value',name:'航班数(架次)',axisLine:{show:true,lineStyle:{color:'rgba(0,245,255,1)'}},textStyle:{color:'rgba(0,245,255,0.7)'},axisLabel:{interval:0,rotate:45,textStyle:{color:'rgba(0,245,255,0.7)'}}}],series:[{name:'航班',yAxisIndex:0,type:'bar',itemStyle:itemStyle,barWidth:40,label:{normal:{textStyle:{color:'rgba(0,245,255,0.5)'},show:true,position:'top',formatter:'{c}'}},},{name:'各类航班数量比重',}]})};let timeOption={baseOption:{color:['green','yellow','red'],timeline:{currentIndex:0,left:"5",bottom:0,width:"95%",axisType:'category',show:true,checkpointStyle:{symbol:'diamond',symbolSize:15,color:'rgba(0,245,255,1)',borderWidth:2,borderColor:'rgba(255,0,0,1)',animationDuration:300},controlStyle:{normal:{color:'rgba(0,245,255,1)',borderColor:"rgba(0,245,255,1)"}},label:{normal:{color:'rgba(0,245,255,0.8)'},emphasis:{}},lineStyle:{color:'rgba(0,245,255,1)'},autoPlay:true,playInterval:2000,data:timedatadata},legend:{show:true,x:'right',y:'top',orient:'vertical',selectedMode:'multiple',data:['正常','延误','取消'],textStyle:{color:'rgba(0,245,255,1)'},inactiveColor:'rgba(100,100,100,1)'},grid:{botom:0,left:'5%',width:"60%"},xAxis:[{type:'category',textStyle:{color:'rgba(0,245,255,1)'},axisLabel:{color:'rgba(0,245,255,1)',interval:0,rotate:0},data:["航班总数","正常数","延误数","取消数"]}],yAxis:[{type:'value',name:'航班数(架次)',axisLine:{show:true,lineStyle:{color:'rgba(0,245,255,1)'}},textStyle:{color:'rgba(0,245,255,0.7)'},axisLabel:{interval:0,rotate:45,textStyle:{color:'rgba(0,245,255,0.7)'}}}],series:[{type:'bar'},{name:'各类航班数量比重',tooltip:{show:true,trigger:'item'},itemStyle:{normal:{borderWidth:5,shadowBlur:30,borderColor:'rgba(0,245,255,0.5)',shadowColor:'rgba(142, 152, 241, 0.6)'}},type:'pie',radius:['65%',"75%"],center:['78%','45%'],labelLine:{normal:{length:3}},hoverAnimation:true,data:[]}]},options:timeData};let c9shuiqiu={tooltip:{show:false},series:[{name:'shuiqiu',type:'liquidFill',waveAnimation:true,amplitude:3,animationDuration:10,center:['50%','50%'],radius:'95%',color:['#564d12','#a1a126'],outline:{show:false},backgroundStyle:{borderColor:'rgba(0,245,255,1)',borderWidth:2,shadowColor:'rgba(0,245,255, 0.4)',shadowBlur:20},shape:'path://M24 19.999l-5.713-5.713 13.713-10.286-4-4-17.141 6.858-5.397-5.397c-1.556-1.556-3.728-1.928-4.828-0.828s-0.727 3.273 0.828 4.828l5.396 5.396-6.858 17.143 4 4 10.287-13.715 5.713 5.713v7.999h4l2-6 6-2v-4l-7.999 0z',label:{align:'center',normal:{align:'center',formatter:function(){return '   总耗油\n 125888847加仑'},textStyle:{align:'center',fontSize:20,color:'#D94854'}}}}]};c9.setOption(c9shuiqiu);let rankingOption={title:[{text:"成都市航线繁荣度全揽",left:'center',textStyle:{color:'rgba(0,245,255,0.7)',fontSize:14}}],tooltip:{trigger:'axis',axisPointer:{type:"shadow"}},legend:{name:'出入港',orient:'vertical',top:'bottom',left:'right',data:['出港','入港'],textStyle:{color:'rgba(0,245,255,0.8)'},selectedMode:'single',inactiveColor:'rgba(100,100,100,1)'},grid:{left:12,right:0,top:20,bottom:0,width:'95%',containLabel:true},xAxis:{name:'/架次',nameLocation:'end',type:'value',label:{show:true},scale:false,position:'top',boundaryGap:false,splitLine:{show:true,lineStyle:{color:'rgba(0,245,255,0.5)'}},axisTick:{show:true,alignWithLabel:false,inside:true,},axisLine:{show:true,lineStyle:{color:'rgba(0,245,255,1)'}},axisLabel:{rotate:0,margin:0,textStyle:{color:'rgba(0,245,255,1)'}},data:[]},yAxis:{type:'category',nameLocation:'end',name:'城市名',nameGap:16,axisLine:{show:false,lineStyle:{color:'rgba(0,245,255,1)'}},axisTick:{show:false,lineStyle:{color:'rgba(0,245,255,1)'}},axisLabel:{interval:'auto',formatter:function(value){if(value.length>8){return value.substring(0,8)+"..."}else{return value}},axisLabel:{interval:'auto'},textStyle:{color:'#fff'}},},series:[{name:"出港",type:'bar',stack:"sum",itemStyle:{normal:{color:new echarts.graphic.LinearGradient(5,1,5,0,[{offset:1,color:'rgba(0,245,255,0.5)'},{offset:0,color:'#00fcae'}])},emphasis:{}},},{name:"入港",type:'bar',stack:"sum",itemStyle:{normal:{color:new echarts.graphic.LinearGradient(5,1,5,0,[{offset:0,color:'rgba(255,140,0,0.8)'},{offset:1,color:'#EE0000'}])},emphasis:{}},label:{},},]};secondXy.setOption({grid:{show:false,top:0},xAxis:[{gridIndex:0,type:'value',show:false,min:0,max:100,nameLocation:'middle',nameGap:5}],yAxis:[{gridIndex:0,min:0,show:false,max:100,nameLocation:'middle',nameGap:30}],tooltip:{show:true,trigger:'item',formatter:function(params){let arr=(params.name).split('\n');return arr[1]+'</br>'+arr[0]}},series:[{name:'航班详细信息',type:'effectScatter',showEffectOn:'emphasis',symbol:'circle',symbolSize:120,label:{normal:{show:true,formatter:'{b}',color:'rgba(90,90,90,1)',textStyle:{fontSize:16}}},itemStyle:{normal:{borderWidth:5,shadowBlur:15,shadowColor:'rgba(0, 245, 255, 1)',borderColor:'rgba(0,245,255,0.6)',color:'rgba(0,245,255,1)',opacity:1}},data:[{name:'2月1日8时0分\n计划起飞',value:[5,70],symbolSize:100,label:{normal:{textStyle:{fontSize:16}}}},{name:'2月1日8时19分\n实际起飞',value:[35,70],symbolSize:100,itemStyle:{normal:{color:'#FA8BFF',opacity:1}}},{name:'2月1日10时41分\n计划到达',value:[65,70],symbolSize:100,itemStyle:{normal:{color:'#2BD2FF',opacity:1}}},{name:'2月1日11时51分\n实际到达',value:[95,70],symbolSize:100,itemStyle:{normal:{color:'#a2e1d4',opacity:1}}},{name:'1077海里\n直线距离',value:[20,50],symbolSize:100,itemStyle:{normal:{color:'#2ae0c8',opacity:1}}},{name:'1393海里\n实际飞行距离',value:[50,50],symbolSize:100,itemStyle:{normal:{color:'#2BFF88',opacity:1}}},{name:'315\n飞行速度(节)',value:[80,50],symbolSize:100,itemStyle:{normal:{color:'#FF6A88',opacity:1}}},{name:'Air China\n航空公司',value:[35,30],symbolSize:100,itemStyle:{normal:{color:'#9FACE6',opacity:1}}},{name:'A321\n飞机型号',value:[65,30],symbolSize:100,itemStyle:{normal:{color:'#bd03d4',opacity:1}}},{name:'3900加仑\n耗油量',value:[50,10],symbolSize:100,itemStyle:{normal:{color:'#e3c887',opacity:1}}}]}]});(function(){map.on('mouseover',function(params){});map.on('click',function(params){console.log(params);if(params.componentSubType=="lines"){console.log(params.data.fromName+">"+params.data.toName);console.log(map.getOption());let oMapOption=map.getOption()}else if(params.componentSubType=="scatter"){console.log(params.name);if(aHighlightEd.indexOf(params.dataIndex)==-1){map.dispatchAction({type:'highlight',seriesName:['航线','城市'],dataIndex:params.dataIndex});aHighlightEd.push(params.dataIndex);}else{let dataIndexOf=aHighlightEd.indexOf(params.dataIndex);if(dataIndexOf!=-1){map.dispatchAction({type:'downplay',seriesName:['航线','城市'],dataIndex:params.dataIndex});aHighlightEd.splice(dataIndexOf,1)}}console.log(aHighlightEd);params.data.value.push("一百");console.log(params.data);}});optionMap.on('mouseover',function(params){if(params.componentSubType=="effectScatter"||params.componentSubType=="scatter"){let arrAirportName=myData.allAirport[params.name];let strAirportName='机场:</br>';for(let i=0;i<arrAirportName.length;i+=1){strAirportName+=arrAirportName[i]+'</br>'}params.data.value[3]=strAirportName;setTimeout(function(){params.data.value[3]=strAirportName},100);}});})();map.setOption(option);c1.setOption(rankingOption);c3.setOption(pieOption);c2.setOption(airLineOption);c5.setOption(timeOption);optionMap.setOption(option);let word={title:{text:'成都市通航城市词云图',x:'center',textStyle:{fontSize:14,color:"rgba(0,245,255,0.7)"}},backgroundColor:'#F7F7F7',tooltip:{show:true},series:[{name:'城市词云',type:'wordCloud',sizeRange:[10,40],rotationRange:[-90,90],rotationStep:5,shape:'polygon',top:'5%',bottom:'2%',width:'100%',height:'100%',textPadding:0,drawOutOfBound:false,gridSize:2,textStyle:{normal:{color:function(){return 'rgb('+[Math.round(Math.random()*255),Math.round(Math.random()*255),Math.round(Math.random()*255)].join(',')+')'}}},}]};c7.setOption(word);function importantCity(e){let input=sys.getel("#searchInput")[0];let warn=sys.getel("#search_result_box i")[0];let inputValue;let search_result_box=sys.getel("#search_result_box")[0];let timer=null;let timer2=null;let oHeaderType=sys.getel("#headType div");let requestURL='';let headClassName='headType_class';let search_box=sys.getel("#search")[0];search_box.addEventListener('mousedown',function(e){e.stopPropagation()});lastTime={data:{name:e.data.name,xy:myData.allCity[e.data.name]}};indexDB.set('lastTime',lastTime,function(){},function(){});let loading=sys.getel("#loading")[0];sys.getel('#headType')[0].addEventListener('mousedown',function(e){e.preventDefault();});let updateURL=function(){if(oHeaderType[0].className==headClassName){requestURL="/node/out/city"}else if(oHeaderType[1].className==headClassName){requestURL="/node/out/city/home"}else{requestURL="/node/out/city/county"}};updateURL();for(let i=0;i<oHeaderType.length;i+=1){oHeaderType[i].addEventListener('click',function(e){for(let ii=0;ii<oHeaderType.length;ii+=1){oHeaderType[ii].className=''}oHeaderType[i].className='headType_class';updateURL();requestArg.requestURL=requestURL;oHeaderType[i].addEventListener('mousedown',function(e){e.preventDefault()});;})}function getTime(unixtime){let date=new Date(unixtime*1000);let str=(date.getMonth()+1)+"月"+date.getDate()+"日";return str};loading.style.display='block';input.blur();search_box.className='';let nowCityName=e.data.name;let nowCityXy=e.data.xy;requestArg.cityName=e.data.name;requestArg.xy=e.data.xy;let sumcity=new CountUp("chart8RankSum",0,3342,0,3.5,{useEasing:true,useGrouping:true,separator:',',decimal:'.'});sumcity.start();let chart8FlightNum=new CountUp("chart8FlightNum",0,Math.round(myData.allCityNum[nowCityName]/3),0,3.5,{useEasing:true,useGrouping:true,separator:',',decimal:'.'});chart8FlightNum.start();let arrCityNumRanking=Object.keys(myData.allCityNum);let chart8Ranking=new CountUp("chart8Ranking",0,(arrCityNumRanking.indexOf(nowCityName))+1,0,3.5,{useEasing:true,useGrouping:true,separator:',',decimal:'.'});chart8Ranking.start();let typingInfo=sys.getel('#typingInfo')[0];typingInfo.className='';sys.getel('#infoTime')[0].innerText=getTime(requestArg.startTime)+'~2018年'+getTime(requestArg.endTime);sys.getel('#typingInfoCity')[0].innerText=e.data.name;function funeveryDayflight(data){location.hash="#indexPage";let cityLength=data.data.name.length;c1.setOption({title:{text:e.data.name+"航线繁荣度全览"},legend:{name:'出入港',selected:{'出港':true}},yAxis:{name:'城市名',data:data.data.name},series:[{name:"出港",data:data.data.value},{name:'入港',data:[]}]});let cityScatter=[];let cityLines=[];let sumValue=0;for(let ii=0;ii<cityLength;ii+=1){cityScatter.push({name:data.data.name[ii],value:myData.allCity[data.data.name[ii]]});cityLines.push({fromName:nowCityName,toName:data.data.name[ii],coords:[nowCityXy,myData.allCity[data.data.name[ii]]],value:data.data.value[ii]});sumValue+=data.data.value[ii]}map.setOption({geo:{center:e.data.xy,zoom:8},series:[{name:"城市",data:cityScatter},{name:"hightScatter",data:[{name:e.data.name,value:e.data.xy}]},{name:"航线",data:cityLines}]});console.log("通航城市数"+cityLength);c1.setOption({yAxis:{name:"城市名",axisLabel:{interval:'auto'}}});c7.setOption({title:{text:e.data.name+'通航城市词云图'},series:{name:'城市词云',data:data.data.word}});saveC1Data=c1.getOption().series[0].data;saveC1yAxis=c1.getOption().yAxis[0].data;saveMapScatter=map.getOption().series[2].data;saveMapLines=map.getOption().series[1].data;saveMapHightScatter=map.getOption().series[0].data;updateDesc('出港',sumValue,cityLength);updateURL();requestArg.outDesc={flights:sumValue,cityLength:cityLength};}indexDB.get(`everyDayflight`+`city=${e.data.name }&timeStart=${requestArg.startTime }&timeEnd=${requestArg.endTime }&state=a`+requestURL,function(data){let DB={data:data};console.log('everyDayflight:');console.log("取自本地");funeveryDayflight(DB);loading.style.display='none';},function(){sys.worker('everyDayflight.js',{arg:`city=${e.data.name }&timeStart=${requestArg.startTime }&timeEnd=${requestArg.endTime }&state=a`,headerType:requestURL},function(data){funeveryDayflight(data);loading.style.display='none';indexDB.set(`everyDayflight`+`city=${e.data.name }&timeStart=${requestArg.startTime }&timeEnd=${requestArg.endTime }&state=a`+requestURL,arguments[0].data,function(){},function(){})});});function funTimeline(flights){let jsonFlights=JSON.parse(flights);let dayLength=(requestArg.endTime-requestArg.startTime)/86400;let startTime=new Date((requestArg.startTime)*1000);let endTime=new Date((requestArg.endTime)*1000);let month=startTime.getMonth()+1;let startDate=startTime.getDate();let allSum=0;let dayName=[];let options=[];let delay=[];let cancel=[];for(let i=0;i<dayLength;i+=1){dayName.push(new Date(((requestArg.startTime+86400*i)*1000)).getMonth()+1+"-"+new Date(((requestArg.startTime+86400*i)*1000)).getDate());let asum=0;let gsum=0;let ysum=0;let rsum=0;for(let cityNum=0;cityNum<jsonFlights.g[i].length;cityNum+=1){gsum+=jsonFlights.g[i][cityNum][1];}for(let cityNum=0;cityNum<jsonFlights.y[i].length;cityNum+=1){ysum+=jsonFlights.y[i][cityNum][1];delay.push({fromName:e.data.name,toName:jsonFlights.y[i][cityNum][0],coords:[myData.allCity[e.data.name],myData.allCity[jsonFlights.y[i][cityNum][0]]],value:jsonFlights.y[i][cityNum][1]})}for(let cityNum=0;cityNum<jsonFlights.r[i].length;cityNum+=1){rsum+=jsonFlights.r[i][cityNum][1];cancel.push({fromName:e.data.name,toName:jsonFlights.r[i][cityNum][0],coords:[myData.allCity[e.data.name],myData.allCity[jsonFlights.r[i][cityNum][0]]],value:jsonFlights.r[i][cityNum][1]})}asum=gsum+ysum+rsum;options.push({title:{text:new Date(((requestArg.startTime+86400*i)*1000)).getMonth()+1+'月'+new Date(((requestArg.startTime+86400*i)*1000)).getDate()+'日'},series:[{data:[asum,gsum,ysum,rsum]},{data:[{name:'正常',value:gsum},{name:'延误',value:ysum},{name:'取消',value:rsum}]}]});allSum+=asum;asum=0;gsum=0;ysum=0;rsum=0}map.setOption({series:[{name:'延误',data:delay},{name:'取消',data:cancel}]});console.log(allSum);c5.setOption({baseOption:{title:{subtext:`${startTime.getMonth()+1}月${startTime.getDate()}日 ~ ${endTime.getMonth()+1}月${endTime.getDate()}日${e.data.name }每日航班概览`},timeline:{currentIndex:0,data:dayName}},options:options})}function funAirline(airline){let airlineData=JSON.parse(airline);let arrAirlineData=[];let arrAirlineName=[];for(let i=0;i<airlineData.length;i+=1){arrAirlineData.push({type:'parallel',name:airlineData[i].name,data:[[airlineData[i].all,airlineData[i].onTime,parseFloat((airlineData[i].percent).toFixed(3))*100,airlineData[i].avgDelay/60]]});arrAirlineName.push(airlineData[i].name)}let airLineOption={title:{x:'center',text:'相关航司信息',textStyle:{fontSize:14,color:'rgba(0,245,255,0.7)'}},color:['red','green','white','black','blue','yellow','#d622ec','#836FFF','#fdffdb','#49c1bf'],legend:{type:'scroll',data:arrAirlineName,left:'85%',orient:'vertical',selectedMode:'multiple',textStyle:{color:'rgba(0,245,255,1)',fontSize:10},inactiveColor:'rgba(100,100,100,1)',tooltip:{show:true}},tooltip:{show:true,trigger:'item',},realtime:false,parallelAxis:[{dim:0,name:'经营规模'},{dim:1,name:'延误数'},{dim:2,name:'准点率 %'},{dim:3,name:'平均延迟(分)'}],parallel:{left:30,bottom:'9%',top:"10%",right:85,width:'auto',parallelAxisDefault:{type:'value',nameLocation:'start',nameGap:8,triggerEvent:true,nameTextStyle:{color:'rgba(0,245,255,0.8)'},axisLine:{lineStyle:{color:'rgba(0,245,255,0.8)',width:2}},axisLabel:{}}},series:arrAirlineData};c2.clear();c2.setOption(airLineOption);}indexDB.get('/node/all/city'+`city=${e.data.name }&timeStart=${requestArg.startTime }&timeEnd=${requestArg.endTime }`,function(data){funTimeline(data);},function(){sys.request('get','/node/all/city',`city=${e.data.name }&timeStart=${requestArg.startTime }&timeEnd=${requestArg.endTime }`,function(flights){funTimeline(flights);indexDB.set('/node/all/city'+`city=${e.data.name }&timeStart=${requestArg.startTime }&timeEnd=${requestArg.endTime }`,flights,function(){},function(){});})});indexDB.get('/node/out/zhundian'+`city=${e.data.name }&timeStart=${requestArg.startTime }&timeEnd=${requestArg.endTime }`,function(data){funAirline(data);},function(){sys.request('get','/node/out/zhundian',`city=${e.data.name }&timeStart=${requestArg.startTime }&timeEnd=${requestArg.endTime }`,function(airline){funAirline(airline);indexDB.set('/node/out/zhundian'+`city=${e.data.name }&timeStart=${requestArg.startTime }&timeEnd=${requestArg.endTime }`,airline,function(){},function(){});},function(err){console.log("请求出错")})});function funCountyName(countyName){let jsonCountyName=JSON.parse(countyName);let arrCountyData=[];let arrCountyName=[];let countyLength=jsonCountyName.length;console.log("航线通往国家和地区数:"+countyLength);for(let i=0;i<countyLength;i+=1){arrCountyData.push({value:jsonCountyName[i][1],name:jsonCountyName[i][0]})}if(requestURL=="/node/out/city/home"){sys.getel("#infoCountry")[0].innerText="。"}else{let infoCountry1=new CountUp("infoCountry",0,countyLength,0,3.5,{useEasing:true,useGrouping:true,separator:',',decimal:'.'});infoCountry1.start()}arrCountyData.sort(function(a,b){return b.value-a.value});for(let c=0;c<countyLength;c+=1){arrCountyName.push(arrCountyData[c].name)}let Top10arrCountyData=arrCountyData.splice(0,setUp.countryTop);let Top10arrCountyName=arrCountyName.splice(0,setUp.countryTop);c3.setOption({title:{x:'center',y:0,textStyle:{fontSize:14,color:'rgba(0,245,255,0.7)'},text:e.data.name+"航班来往国家TOP榜"},legend:{name:'国家图例',data:Top10arrCountyName,selected:{'本国':false}},series:[{name:'来往国家',data:Top10arrCountyData}]});if(countyLength<=2){c3.setOption({legend:{name:'国家图例',selected:{'本国':true}}})}}indexDB.get('/node/all/countyName'+`city=${e.data.name }&timeStart=${requestArg.startTime }&timeEnd=${requestArg.endTime }`,function(countyName){funCountyName(countyName);},function(){sys.request('get','/node/all/countyName',`city=${e.data.name }&timeStart=${requestArg.startTime }&timeEnd=${requestArg.endTime }`,function(countyName){funCountyName(countyName);indexDB.set('/node/all/countyName'+`city=${e.data.name }&timeStart=${requestArg.startTime }&timeEnd=${requestArg.endTime }`,countyName,function(){},function(){});})});function funWeatherOrOli(weatherData){sys.request('get','/node/weather',`city=${e.data.name }&timeStart=${requestArg.startTime }&timeEnd=${requestArg.endTime }&aa=1`,function(serverWeatherData){let jsonData=JSON.parse(serverWeatherData);let hightTemp=[];let lowTemp=[];let keys=Object.keys(jsonData);let keysTime=[];for(let i=0;i<keys.length;i+=1){hightTemp.push(jsonData[keys[i]].day[1]);lowTemp.push(jsonData[keys[i]].night[1]);keysTime.push(getTime(keys[i]))}console.log(hightTemp);console.log(lowTemp);if(keys.length!=0){c9.clear();c9.setOption({grid:{left:-5,right:50,top:50,bottom:5,width:'91%',containLabel:true},title:{textStyle:{color:'rgba(0,245,255,0.6)',fontSize:14},x:'center',text:e.data.name+'天气',subtext:getTime(requestArg.startTime)+'~'+getTime(requestArg.endTime)},tooltip:{trigger:'axis',formatter:function(params){let txt='<p style=font-size:0.16rem>时间：'+params[0].name+'</p>';for(let all=0;all<params.length;all+=1){if(params[all].seriesName=='最高气温'){txt+=`<div>${params[all].seriesName }：<span style='color:#FFA54F'>    ${params[all].data }℃</span><div>`}else if(params[all].seriesName=='最低气温'){txt+=`<div>${params[all].seriesName }：<span style='color:#abf4fc'>    ${params[all].data }℃</span><div>`}}let index=params[0].dataIndex;txt+=`<p style='font-size:0.16rem'>白天：</p>
									<div>天气概述：${jsonData[keys[index]].day[0]}</div>
									<div>风向： ${jsonData[keys[index]].day[2]}，风力级别：${jsonData[keys[index]].day[3]}</div>
									<p style='font-size:0.16rem'>夜间：</p>
									<div>天气概述：${jsonData[keys[index]].night[0]}</div>
									<div>风向： ${jsonData[keys[index]].night[2]}，风力级别：${jsonData[keys[index]].night[3]}</div>`;return txt}},legend:{left:5,selectedMode:'multiple',textStyle:{color:'rgba(0,245,255,1)',fontSize:12},inactiveColor:'rgba(100,100,100,1)',tooltip:{show:true},data:['最高气温','最低气温']},toolbox:{show:true,feature:{dataZoom:{yAxisIndex:'none'},magicType:{type:['line','bar']}}},xAxis:{interval:'auto',type:'category',boundaryGap:false,axisLabel:{rotate:0,margin:6,textStyle:{color:'rgba(0,245,255,1)'}},axisLine:{show:true,lineStyle:{color:'rgba(0,245,255,1)'}},splitLine:{show:false},data:keysTime},yAxis:{type:'value',axisPointer:{label:{show:true}},axisLabel:{formatter:'{value} °C',textStyle:{color:'rgba(0,245,255,1)'}},axisLine:{show:false,lineStyle:{color:'rgba(0,245,255,1)'}},splitLine:{show:true,lineStyle:{color:'rgba(0,245,255,0.2)'}}},series:[{name:'最高气温',type:'line',itemStyle:{normal:{color:new echarts.graphic.LinearGradient(5,1,5,0,[{offset:1,color:'#FF3030'},{offset:0,color:'#FFA54F'}])}},lineStyle:{normal:{width:3}},data:hightTemp,markPoint:{symbol:'pin',symbolSize:35,data:[{type:'max',name:'最大值'}]},markLine:{data:[{type:'average',name:'平均值',label:{normal:{color:'#FFA54F',position:'end',formatter:'平均值'}}}]}},{name:'最低气温',type:'line',data:lowTemp,itemStyle:{normal:{color:new echarts.graphic.LinearGradient(5,1,5,0,[{offset:1,color:'rgba(0,245,255,1)'},{offset:0,color:'#abf4fc'}])}},lineStyle:{normal:{width:3}},markPoint:{symbol:'pin',symbolSize:35,data:[{type:'min',name:'最大值'}]},markLine:{data:[{type:'average',name:'平均值',label:{normal:{color:'#abf4fc',position:'end',formatter:'平均值'}}}]}}]})}else{sys.request('get','/node/juhe/city/oli',`city=${e.data.name }&timeStart=${requestArg.startTime }&timeEnd=${requestArg.endTime }`,function(oli){let jsonOli=JSON.parse(oli);c9.clear();let waveAnimation;if(setUp.oliAnimation){waveAnimation=true}else{waveAnimation=false}c9.setOption({title:{text:''},series:[{name:'shuiqiu',type:'liquidFill',waveAnimation:waveAnimation,amplitude:11,center:['50%','50%'],data:[0.6,0.4],radius:'95%',rotate:40,color:['#564d12 ','#a1a126 ','#cdcd0e'],outline:{show:false},backgroundStyle:{borderColor:'rgba(0,245,255,1)',borderWidth:2,shadowColor:'rgba(0,245,255, 0.4)',shadowBlur:0},shape:'path://M24 19.999l-5.713-5.713 13.713-10.286-4-4-17.141 6.858-5.397-5.397c-1.556-1.556-3.728-1.928-4.828-0.828s-0.727 3.273 0.828 4.828l5.396 5.396-6.858 17.143 4 4 10.287-13.715 5.713 5.713v7.999h4l2-6 6-2v-4l-7.999 0z',label:{align:'center',normal:{align:'center',formatter:function(){return `总耗油\n ${jsonOli[0]}加仑`},textStyle:{align:'center',fontSize:20,color:'#D94854'}}}}]})})}})}funWeatherOrOli();}let lastTime={data:{name:'成都市',xy:myData.allCity['成都市']}};indexDB.get('lastTime',function(lastData){importantCity(lastData)},function(){indexDB.set('lastTime',lastTime,function(){importantCity(lastTime)},function(){})});sys.checkCoptionMapPage=function(){if(location.hash!="#optionMapPage"){optionMap.setOption({series:[{name:"城市",data:[]}]})}else{(function(){let workerScatter=new Worker("./js/webworker/scatter.js");workerScatter.postMessage(myData.allCity);workerScatter.onmessage=function(scatter){optionMap.setOption({title:{text:'通航城市全景',textStyle:{color:'rgba(0,245,255,1)',fontSize:16}},visualMap:{name:"散点",seriesIndex:2,type:'continuous',min:0,max:30000,text:['繁忙',''],realtime:false,calculable:true,inRange:{color:['#00FF7F','#7FFF00','#FFF68F','#FFFF00','#e89592','red'],symbolSize:[5,15]},textStyle:{color:'rgba(0,245,255,1)'},dimension:2},series:[{name:"城市",data:scatter.data}]});}})()}};sys.checkCoptionMapPage();window.addEventListener("hashchange",function(e){sys.checkCoptionMapPage();},false);function updateDesc(type,argflights,argcityNum){let typingInfo=sys.getel('#typingInfo')[0];typingInfo.className='typing1';let cityNum=new CountUp("infoNumCitys",0,argcityNum,0,3,{useEasing:true,useGrouping:true,separator:',',decimal:'.'});let infoNumFlights=new CountUp("infoNumFlights",0,argflights,0,3,{useEasing:true,useGrouping:true,separator:',',decimal:'.'});let infoType=sys.getel("#infoType")[0];let infoHome_country=sys.getel("#infoHome_country")[0];let info_moText=sys.getel("#info_moText")[0];setTimeout(function(){infoNumFlights.start();cityNum.start()},2200);if(type=="入港"){switch(requestArg.requestURL){case '/node/out/city':infoType.innerText="入港航班共";infoHome_country.innerText="来自全球";info_moText.style.display='inline';;break;case '/node/out/city/home':infoType.innerText="国内入港航班共";infoHome_country.innerText="来自全国";info_moText.style.display='none';break;case '/node/out/city/county':infoType.innerText="国际入港航班共";infoHome_country.innerText="来自全球";info_moText.style.display='inline';break;default:infoType.innerText="入港航班共";infoHome_country.innerText="来自全球";info_moText.style.display='inline';break}}else{switch(requestArg.requestURL){case '/node/out/city':infoType.innerText="出港航班共";infoHome_country.innerText="通往全球";info_moText.style.display='inline';;break;case '/node/out/city/home':infoType.innerText="国内出港航班共";infoHome_country.innerText="通往全国";info_moText.style.display='none';break;case '/node/out/city/county':infoType.innerText="国际出港航班共";infoHome_country.innerText="通往全球";info_moText.style.display='inline';break;default:infoType.innerText="出港航班共";infoHome_country.innerText="通往全球";info_moText.style.display='inline';break}}}(function(){let input=sys.getel("#searchInput")[0];let warn=sys.getel("#search_result_box i")[0];let inputValue;let search_result_box=sys.getel("#search_result_box")[0];let timer=null;let timer2=null;let oHeaderType=sys.getel("#headType div");let requestURL='';let headClassName='headType_class';let search_box=sys.getel("#search")[0];search_box.addEventListener('mousedown',function(e){e.stopPropagation()});let loading=sys.getel("#loading")[0];sys.getel('#headType')[0].addEventListener('mousedown',function(e){e.preventDefault();});let updateURL=function(){if(oHeaderType[0].className==headClassName){requestURL="/node/out/city"}else if(oHeaderType[1].className==headClassName){requestURL="/node/out/city/home"}else{requestURL="/node/out/city/county"}};updateURL();for(let i=0;i<oHeaderType.length;i+=1){oHeaderType[i].addEventListener('click',function(e){for(let ii=0;ii<oHeaderType.length;ii+=1){oHeaderType[ii].className=''}oHeaderType[i].className='headType_class';updateURL();requestArg.requestURL=requestURL;oHeaderType[i].addEventListener('mousedown',function(e){e.preventDefault()});;})}loading.style.display='none';input.oninput=function(){updateURL();console.log(requestURL);requestArg.requestURL=requestURL;console.log(requestArg.type);let re=/[>_<\(?~？！\){。}、%&\$@!=\-,.\+\*]/gm;inputValue=this.value.replace(re,"");if(re.test(this.value)){warn.innerHTML="星云已为您过滤特殊字符"}if(inputValue){clearTimeout(timer);timer=setTimeout(function(){let posObj={inputValue:inputValue,allCity:myData.allCity};if(requestArg.type=="城市名"){sys.worker("search.js",posObj,function(e){let oldDiv=sys.getel("#search_result_box div");for(let i=0;i<oldDiv.length;i+=1){search_result_box.removeChild(oldDiv[i])}if(Array.isArray(e.data.name)&&Array.isArray(e.data.xy)){let dataLength=e.data.name.length;if(e.data.name.length==0){warn.innerHTML="没有查询到结果,请尝试减少关键词"}else{warn.innerHTML="星云为您找到如下城市:";for(let i=0;i<dataLength;i+=1){let div=doc.createElement("div");let span=doc.createElement("span");span.className="fa fa-map-marker";div.innerText=e.data.name[i];search_result_box.appendChild(div);div.addEventListener('click',function(){let importantCityData={data:{name:e.data.name[i],xy:e.data.xy[i]}};importantCity(importantCityData)});div.appendChild(span);span.addEventListener('click',function(event){event.stopPropagation();if(location.hash=="#indexPage"){map.setOption({geo:{center:e.data.xy[i],zoom:15},tooltip:{trigger:'item',formatter:function(params){let returnValue="空";if(location.hash=="#indexPage"){if(params.seriesType=="scatter"||params.seriesType=="effectScatter"){return params.name}else if(params.seriesType=="lines"){return params.data.fromName+'>'+params.data.toName+"</br>航班数:"+params.data.value+"架次"}}else{if(params.seriesType=="scatter"||params.seriesType=="effectScatter"){if(params.value[2]){return params.name+"</br>月均起降:"+params.value[2]+"架次"}else{console.log(params.value[2]);return params.name+"</br>月均起降:暂无数据"}}else if(params.seriesType=="lines"){return params.data.fromName+'>'+params.data.toName+"</br>航班数:"+params.data.value+"架次"}}}},series:[{name:"hightScatter",data:map.getOption().series[0].data.concat({name:e.data.name[i],value:e.data.xy[i].concat(Math.round(myData.allCityNum[e.data.name[i]]/3))})}]},false);}else if(location.hash=="#optionMapPage"){optionMap.setOption({geo:{center:e.data.xy[i],zoom:12},series:[{name:"hightScatter",data:optionMap.getOption().series[0].data.concat({name:e.data.name[i],value:e.data.xy[i].concat(Math.round(myData.allCityNum[e.data.name[i]]/3))})}]},false)}})}}}})}else if(requestArg.type=="国家名"){}else if(requestArg.type=="航班号"){let oldDiv=sys.getel("#search_result_box div");for(let i=0;i<oldDiv.length;i+=1){search_result_box.removeChild(oldDiv[i])}clearTimeout(timer2);timer2=setTimeout(function(){let oldDiv=sys.getel("#search_result_box div");for(let i=0;i<oldDiv.length;i+=1){search_result_box.removeChild(oldDiv[i])}sys.request('get','/node/indent',`ident=${ inputValue }&time=${requestArg.singleTime }`,function(indentInfo){warn.innerHTML="星云为您找到如下航班号";let jsonIndentInfo=JSON.parse(indentInfo);if(jsonIndentInfo.length==0){warn.innerHTML="星云未找到该航班号,当天该航班可能未起飞"}else{function getTime(unixtime){let date=new Date(unixtime*1000);let str=(date.getMonth()+1)+"月"+date.getDate()+"日"+date.getHours()+"时"+date.getMinutes()+"分";return str};for(let i=0;i<jsonIndentInfo.length;i+=1){let div=doc.createElement("div");let code=doc.createElement("code");code.innerText=`${jsonIndentInfo[i][1].substr(0,8)} → ${jsonIndentInfo[i][2].substr(0,8)}`;div.innerText=jsonIndentInfo[i][0];search_result_box.appendChild(div);div.appendChild(code);div.addEventListener('click',function(){if(sys.getel('.secondPageAnimationClose')[0]){sys.getel('[tool=switch]')[0].click()}location.hash="indexPage";search_box.className='';sys.request('get','/node/indent/info',`ident=${jsonIndentInfo[i][0]}&time=${requestArg.singleTime }`,function(IdentData){let jsonIndentDeta=JSON.parse(IdentData);let jsonIndentDetaLength=jsonIndentDeta.length;console.log(jsonIndentDeta);let uiValue=[[5,70],[35,70],[65,70],[95,70],[20,50],[50,50],[80,50],[35,30],[65,30],[50,10]];let scatterColor=['rgba(0,245,255,1)','#FA8BFF','#2BD2FF','#a2e1d4','#2ae0c8','#2BFF88','#FF6A88','#9FACE6','#bd03d4','#e3c887'];let scatter10=[getTime(jsonIndentDeta.offPlan)+'\n 计划起飞',getTime(jsonIndentDeta.offActual)+'\n 实际起飞',getTime(jsonIndentDeta.landPlan)+'\n 计划到达',getTime(jsonIndentDeta.landActual)+'\n 实际到达',jsonIndentDeta.lineDistance+'海里\n 直线距离',jsonIndentDeta.distanceActual+'海里\n 飞行距离',jsonIndentDeta.speed+'\n 飞行均速(节)',jsonIndentDeta.companyName+'\n 航司名',jsonIndentDeta.flightType+'\n 飞机型号',jsonIndentDeta.oil+"加仑\n 耗油量"];let oSpanCity=sys.getel("#secondCityName span");let oSpanairport=sys.getel("#secondFlyName span");oSpanCity[0].innerText=jsonIndentDeta.startCity;oSpanCity[1].innerText=jsonIndentDeta.endCity;oSpanairport[0].innerText=jsonIndentDeta.startAirport.substr(0,10)+'...';oSpanairport[0].title=jsonIndentDeta.startAirport;oSpanairport[1].innerText=jsonIndentDeta.endAirport.substr(0,10)+'...';oSpanairport[1].title=jsonIndentDeta.endAirport;let oIarrow=sys.getel("#secondCityName i")[0];switch(jsonIndentDeta.state){case '正常':oIarrow.style.color="#02ee02";oIarrow.title="正常";break;case '晚点':oIarrow.style.color="yellow";oIarrow.title="晚点";break;default:oIarrow.style.color="red";oIarrow.title="该航班已取消";break}let uiNameType=[];let arrSingleIdentData=[];for(let i=0;i<10;i+=1){arrSingleIdentData.push({name:scatter10[i],value:uiValue[i],itemStyle:{normal:{color:scatterColor[i]}}})}secondXy.setOption({series:[{name:'航班详细信息',data:arrSingleIdentData}]});})})}}})},100)}else{console.error("没有正确的选择的类型")}},100)}else{warn.innerHTML="不知道搜索什么?请告诉星云哦!"}}})();let saveC1Data=c1.getOption().series[0].data;let saveC1yAxis=c1.getOption().yAxis[0].data;let saveMapScatter=map.getOption().series[2].data;let saveMapLines=map.getOption().series[1].data;let saveMapHightScatter=map.getOption().series[0].data;let typingInfo=sys.getel('#typingInfo')[0];let loading=sys.getel("#loading")[0];c1.on('legendselectchanged',function(params){loading.style.display='block';typingInfo.className='';if(params.name=="入港"&&params.selected['入港']){console.log('点击了入港且入港为true');let requestInURL='';console.log('原来的请求地址'+requestArg.requestURL);switch(requestArg.requestURL){case '/node/out/city':requestInURL='/node/in/city';break;case '/node/out/city/home':requestInURL='/node/in/city/home';break;case '/node/out/city/county':requestInURL='/node/in/city/county';break;default:requestInURL='/node/in/city';break}function inEveryDayflight(data){let arrscatterInCity=[];let cityLength=data.data.name.length;let cityLines=[];let inFlights=0;for(let i=0;i<cityLength;i+=1){arrscatterInCity.push({name:data.data.name[i],value:myData.allCity[data.data.name[i]]});cityLines.push({fromName:data.data.name[i],toName:requestArg.cityName,coords:[myData.allCity[data.data.name[i]],myData.allCity[requestArg.cityName]],value:data.data.value[i]});inFlights+=data.data.value[i]}c1.setOption({yAxis:{name:'城市名',data:data.data.name},series:[{name:"出港",data:[]},{name:'入港',data:data.data.value}]});map.setOption({geo:{center:myData.allCity[requestArg.cityName],zoom:8},series:[{name:"城市",data:arrscatterInCity},{name:"hightScatter",data:[{name:requestArg.cityName,value:myData.allCity[requestArg.cityName]}]},{name:"航线",data:cityLines}]});updateDesc('入港',inFlights,cityLength);loading.style.display='none';};indexDB.get('everyDayflight'+`city=${requestArg.cityName }&timeStart=${requestArg.startTime }&timeEnd=${requestArg.endTime }&state=a`+requestInURL,function(data){let DB={data:data};inEveryDayflight(DB);},function(){sys.worker('everyDayflight.js',{arg:`city=${requestArg.cityName }&timeStart=${requestArg.startTime }&timeEnd=${requestArg.endTime }&state=a`,headerType:requestInURL},function(data){inEveryDayflight(data);indexDB.set('everyDayflight'+`city=${requestArg.cityName }&timeStart=${requestArg.startTime }&timeEnd=${requestArg.endTime }&state=a`+requestInURL,data.data,function(){},function(){});})});}else if(params.name=="出港"&&params.selected['出港']){c1.setOption({yAxis:{name:'城市名',data:saveC1yAxis},series:[{name:"出港",data:saveC1Data},{name:'入港',data:[]}]});map.setOption({geo:{center:myData.allCity[requestArg.cityName],zoom:8},series:[{name:"城市",data:saveMapScatter},{name:"hightScatter",data:[{name:requestArg.cityName,value:myData.allCity[requestArg.cityName]}]},{name:"航线",data:saveMapLines}]});typingInfo.className='';setTimeout(function(){updateDesc('出港',requestArg.outDesc.flights,requestArg.outDesc.cityLength)},100);loading.style.display='none';}});(function(){var data=[10,45,0,25,13,1,10,5];var timeName=[];for(var i=0;i<8;i+=1){timeName.push({name:i*3+':00~'+parseInt(i*3+3)+":00",value:data[i]})}let secondOption={title:{text:'分时',x:'center',y:'center',textStyle:{fontWeight:'normal',fontSize:20,color:"rgba(0,245,255,1)"}},tooltip:{trigger:'item',formatter:"{b} : {c} <br/>({d}%)"},visualMap:{type:"continuous",show:true,min:Math.min.apply(null,data),max:Math.max.apply(null,data),inRange:{color:["rgba(0,250,154,1)",'rgba(255,255,0,0.3)','rgba(255,255,0,0.5)','rgba(255,64,64,0.5)']},dimension:0},color:['rgba(0,245,255,1)'],series:[{type:'pie',data:timeName,radius:['70%','99%'],zlevel:1,itemStyle:{normal:{color:'rgba(0,255,245,1)',borderColor:'white'}},label:{show:true,normal:{position:'inside',color:"rgba(0,245,255,1)"}},labelLine:{show:false}}]};})();(function(){let btnCity=sys.getel('[tool=optionCity]')[0];let btnCounty=sys.getel('[tool=optionCounty]')[0];let btnAllEye=sys.getel('[tool=optionEye]')[0];btnCity.addEventListener('click',function(e){layui.use('layer',function(){var layer=layui.layer;layer.msg('请选择两个城市,查看其航线',{skin:'optionMsg',icon:7,time:2000})});btnCounty.style.cssText='';btnCity.setAttribute('checked',true);btnCounty.setAttribute('checked',false);btnAllEye.style.cssText='';this.style.cssText="color:rgba(0,245,255,1);border: 0.02rem solid rgba(0,245,255,1);";optionMap.setOption({legend:{name:'城市',selected:{'城市':true}}});e.stopPropagation()});btnCounty.addEventListener('click',function(e){btnCity.style.cssText='';layui.use('layer',function(){var layer=layui.layer;layer.msg('请选择两个国家,查看两国所有航线',{skin:'optionMsg',icon:7,time:2000,})});optionMap.setOption({legend:{name:'城市',selected:{'城市':false}}});btnAllEye.style.cssText='';btnCity.setAttribute('checked',false);btnCounty.setAttribute('checked',true);this.style.cssText="color:rgba(0,245,255,0.8);border: 0.02rem solid rgba(0,245,255,0.8);";e.stopPropagation()});btnAllEye.addEventListener('click',function(e){optionMap.setOption({series:[{name:'航线',data:[]}]});btnCity.style.cssText='';btnCounty.style.cssText='';btnCity.setAttribute('checked',false);btnCounty.setAttribute('checked',false);optionMap.setOption({legend:{name:'城市',selected:{'城市':true}}});this.style.cssText="color:rgba(0,245,255,0.8);border: 0.02rem solid rgba(0,245,255,0.8);";e.stopPropagation()});let arrCounty=[];let arrCity=[];optionMap.on('click',function(params){let state=function(){if(btnCity.getAttribute('checked')=='true'){return 'btnCity'}else if(btnCounty.getAttribute('checked')=='true'){return 'btnCounty'}else{return ''}};if(state()=="btnCounty"&&params.componentType=="geo"){if(params.name=='Korea'){params.name='South Korea'}else if(params.name=='Dem. Rep. Korea'){params.name='North Korea'}arrCounty.push(params.name);layui.use('layer',function(){let layer=layui.layer;layer.msg('您选择了'+arrCounty[0]+',请继续选择',{skin:'optionMsg',icon:7,time:3500,offset:'rt'})});console.log(arrCounty);if(arrCounty.length==2){if(arrCounty[0]==arrCounty[1]){arrCounty.pop();layui.use('layer',function(){var layer=layui.layer;layer.msg('请勿重复选择',{skin:'optionMsg',icon:7,time:1500})})}else{layui.use('layer',function(){var layer=layui.layer;layer.msg(arrCounty[0]+'与'+arrCounty[1]+'的航线加载中,请稍后',{skin:'optionMsg',icon:7,time:2000})});sys.request('get','/node/twoCountry',`fromCountry=${arrCounty[0]}&toCountry=${arrCounty[1]}`,function(countyLineData){let jsonData=JSON.parse(countyLineData);let linesData=[];let arrFrom_cityName=Object.keys(jsonData);for(let i=0;i<arrFrom_cityName.length;i+=1){for(let ii=0;ii<jsonData[arrFrom_cityName[i]].length;ii+=1){linesData.push({fromName:arrFrom_cityName[i],toName:jsonData[arrFrom_cityName[i]][ii],coords:[myData.allCity[arrFrom_cityName[i]],myData.allCity[jsonData[arrFrom_cityName[i]][ii]]]})}}if(arrFrom_cityName.length==0){layui.use('layer',function(){let layer=layui.layer;layer.msg(arrCounty[0]+'与'+arrCounty[1]+'没有航线',{skin:'optionMsg',icon:2,time:2500,})})}else{layui.use('layer',function(){let layer=layui.layer;layer.msg(arrCounty[0]+'与'+arrCounty[1]+'航线加载完成',{skin:'optionMsg',icon:1,time:2000})})}console.log();optionMap.setOption({series:[{name:'航线',zlevel:1,animation:false,blendMode:"lighter",polyline:false,large:true,largeThreshold:5000,symbol:'none',symbolSize:6,effect:{show:false,period:10,trailLength:0,symbol:false,symbolSize:10,color:"rgba(0,245,255,1)"},data:linesData}]});arrCounty=[];});}}}else if(state()=="btnCity"&&params.componentSubType=="scatter"||state()=="btnCity"&&params.componentSubType=='effectScatter'){arrCity.push(params.name);layui.use('layer',function(){let layer=layui.layer;layer.msg('您选择了'+arrCity[0]+',请继续选择',{skin:'optionMsg',icon:7,time:3500,offset:'rt'})});console.log(arrCounty);if(arrCity.length==2){if(arrCity[0]==arrCity[1]){arrCity.pop();layui.use('layer',function(){let layer=layui.layer;layer.msg('请勿重复选择',{skin:'optionMsg',icon:7,time:1500})})}else{layui.use('layer',function(){var layer=layui.layer;layer.msg(arrCity[0]+'与'+arrCity[1]+'两个城市的通航信息加载中,请稍后',{skin:'optionMsg',icon:7,time:2000})});sys.request("get",'/node/list',`fromName=${arrCity[0]}&toName=${arrCity[1]}&time=${requestArg.singleTime }`,function(identList){let jsonList=JSON.parse(identList);console.log(jsonList);if(jsonList.length==0){layui.use('layer',function(){let layer=layui.layer;layer.msg(arrCity[0]+'与'+arrCity[1]+'当日没有通航,CTRL+F 航班号中可修改日期',{skin:'optionMsg',icon:2,time:2500})})}else{let dataTable=`
											<div class='table_head'>
											<span>航班号</span>
											<span>起飞机场</span>
											<span>计划起飞</span>
											<span>计划到达</span>
											<span>降落机场</span>
											</div>`;function getTime(unixtime){let date=new Date(unixtime*1000);let str=(date.getMonth()+1)+"月"+date.getDate()+"日"+date.getHours()+"时"+date.getMinutes()+"分";return str};function subTex(str){return str.substr(0,10)+"..."}for(let i=0;i<jsonList.length;i+=1){dataTable+=`
											<div class='table_rows'>
												<span class='table_ident'>${jsonList[i].ident }</span>
												<span class="table_startAirport">${subTex(jsonList[i].startAirportName)}</span>
												<span class="table_planFei">${getTime(jsonList[i].offPlan)}</span>
												<span class="table_planLan">${getTime(jsonList[i].landPlan)}</span>
												<span class="table_endAirport">${subTex(jsonList[i].endAirportName)}</span>
											</div>`}layui.use('layer',function(){let layer=layui.layer;layer.open({type:1,title:'航班信息略表',skin:'layui-layer-rim',area:['10rem','6rem'],shadeClose:true,content:dataTable});let oRows=sys.getel('.table_rows');for(let i=0;i<oRows.length;i+=1){oRows[i].addEventListener('click',function(){let indentArg=oRows[i].getElementsByClassName('table_ident')[0];if(sys.getel('.secondPageAnimationClose')[0]){sys.getel('[tool=switch]')[0].click()}location.hash="indexPage";sys.request('get','/node/indent/info',`ident=${indentArg.innerText }&time=${requestArg.singleTime }`,function(IdentData){let jsonIndentDeta=JSON.parse(IdentData);let jsonIndentDetaLength=jsonIndentDeta.length;console.log(jsonIndentDeta);let uiValue=[[5,70],[35,70],[65,70],[95,70],[20,50],[50,50],[80,50],[35,30],[65,30],[50,10]];let scatterColor=['rgba(0,245,255,1)','#FA8BFF','#2BD2FF','#a2e1d4','#2ae0c8','#2BFF88','#FF6A88','#9FACE6','#bd03d4','#e3c887'];let scatter10=[getTime(jsonIndentDeta.offPlan)+'\n 计划起飞',getTime(jsonIndentDeta.offActual)+'\n 实际起飞',getTime(jsonIndentDeta.landPlan)+'\n 计划到达',getTime(jsonIndentDeta.landActual)+'\n 实际到达',jsonIndentDeta.lineDistance+'海里\n 直线距离',jsonIndentDeta.distanceActual+'海里\n 飞行距离',jsonIndentDeta.speed+'\n 飞行均速(节)',jsonIndentDeta.companyName+'\n 航司名',jsonIndentDeta.flightType+'\n 飞机型号',jsonIndentDeta.oil+"加仑\n 耗油量"];let oSpanCity=sys.getel("#secondCityName span");let oSpanairport=sys.getel("#secondFlyName span");oSpanCity[0].innerText=jsonIndentDeta.startCity;oSpanCity[1].innerText=jsonIndentDeta.endCity;oSpanairport[0].innerText=jsonIndentDeta.startAirport.substr(0,10)+'...';oSpanairport[0].title=jsonIndentDeta.startAirport;oSpanairport[1].innerText=jsonIndentDeta.endAirport.substr(0,10)+'...';oSpanairport[1].title=jsonIndentDeta.endAirport;let oIarrow=sys.getel("#secondCityName i")[0];switch(jsonIndentDeta.state){case '正常':oIarrow.style.color="#02ee02";oIarrow.title="正常";break;case '晚点':oIarrow.style.color="yellow";oIarrow.title="晚点";break;default:oIarrow.style.color="red";oIarrow.title="该航班已取消";break}let uiNameType=[];let arrSingleIdentData=[];for(let i=0;i<10;i+=1){arrSingleIdentData.push({name:scatter10[i],value:uiValue[i],itemStyle:{normal:{color:scatterColor[i]}}})}secondXy.setOption({series:[{name:'航班详细信息',data:arrSingleIdentData}]});layer.closeAll();});});}})}arrCity=[]});}console.log(params.name)}}if(params.componentSubType=="lines"){console.log(params.data.fromName+">"+params.data.toName);}})})();console.timeEnd("全局");(function(){let checkbox=sys.getel("#checkbox")[0];let checkbox_lines=sys.getel("#checkbox_lines")[0];let linesHightColor=sys.getel("#lines_color")[0];let imageType=sys.getel("#imageType input");let timedely=sys.getel("#timedely")[0];let timedelyNum=sys.getel("#timedelyNum")[0];let countryTop=sys.getel("#countryTop")[0];let countryTopNum=sys.getel("#countryTopNum")[0];if(setUp.linesAnimation==true){checkbox_lines.checked='checked'}else{checkbox_lines.checked=false};if(setUp.oliAnimation==true){checkbox.checked='checked'}else{checkbox.checked=false};linesHightColor.value=setUp.linesHightColor;if(setUp.saveImageType=="png"){imageType[0].checked='checked';imageType[1].checked=false}else{imageType[1].checked='checked';imageType[0].checked=false}timedely.value=setUp.timeLineDelay;timedelyNum.innerText=setUp.timeLineDelay;countryTop.value=setUp.countryTop;countryTopNum.innerText=setUp.countryTop;let timedelytimer=null;let timeCountyTop=null;(function(){function checkLines(){if(this.checked){map.setOption({series:[{name:'航线',animation:true,blendMode:"lighter",effect:{show:true,symbol:planePath}}]});setUp.linesAnimation=true;sys.mySave.save('setUp',setUp)}else{map.setOption({series:[{name:'航线',animation:false,blendMode:"",effect:{show:false,symbol:''}}]});setUp.linesAnimation=false;sys.mySave.save('setUp',setUp)}};function checkOli(){if(this.checked){setUp.oliAnimation=true;sys.mySave.save('setUp',setUp)}else{c9.setOption({series:[{name:'shuiqiu',waveAnimation:false,amplitude:0,animationDuration:0,animationDurationUpdate:0}]});setUp.oliAnimation=false;sys.mySave.save('setUp',setUp)}}function checkLinesHightColor(){console.log(this.value);map.setOption({series:[{name:'航线',lineStyle:{emphasis:{color:this.value}}}]});setUp.linesHightColor=this.value;sys.mySave.save('setUp',setUp)};function checkSaveImageType(){for(let i=0;i<2;i+=1){imageType[i].addEventListener('input',function(){if(this.checked){setUp.saveImageType=this.getAttribute('id');sys.mySave.save('setUp',setUp);}})}};function checkTimeDely(){c5.setOption({baseOption:{timeline:{playInterval:this.value}}})}function checkCountryTop(){setUp.countryTop=this.value;sys.mySave.save('setUp',setUp)}countryTop.addEventListener('input',function(){clearTimeout(timeCountyTop);timeCountyTop=setTimeout(function(){checkCountryTop.apply(countryTop,[]);layui.use('layer',function(){let layer=layui.layer;layer.msg('来往国家Top数成功修改为'+countryTop.value+'个,下次查询即可生效',{skin:'optionMsg',icon:1,time:2000})})},800);countryTopNum.innerText=this.value;});checkTimeDely.apply(timedely,[]);timedely.addEventListener('input',function(){let that=this;clearTimeout(timedelytimer);timedelyNum.innerText=this.value;timedelytimer=setTimeout(function(){checkTimeDely.apply(timedely,[]);setUp.timeLineDelay=that.value;layui.use('layer',function(){let layer=layui.layer;layer.msg('每日航班概览自动播放间隔设置为'+that.value+'毫秒成功',{skin:'optionMsg',icon:1,time:1500})});sys.mySave.save('setUp',setUp)},800)});checkSaveImageType();checkLines.apply(checkbox_lines,[]);checkOli.apply(checkbox,[]);checkbox_lines.addEventListener('input',function(){checkLines.apply(checkbox_lines,[])});checkLinesHightColor.apply(linesHightColor,[]);checkbox.addEventListener('input',function(){checkOli.apply(checkbox,[])});linesHightColor.addEventListener('input',function(){checkLinesHightColor.apply(linesHightColor,[])})})();})();sys.getel('[menu=infoMe]')[0].addEventListener('click',function(e){sys.getel("#about")[0].style.transform="rotateZ(720deg) scale(1)";let oMenu=sys.getel("#menu")[0];oMenu.style.display="none";e.stopPropagation()},false);sys.getel("#about")[0].addEventListener('click',function(e){sys.getel("#menu")[0].style.display='none';e.stopPropagation();return false},false);(function(){let socket;let btnOpenChat=sys.getel('[tool=chat]')[0];let btnCloseChat=sys.getel('#chat .fa-close')[0];let oChat=sys.getel('#chat')[0];let oChat_title=sys.getel('#chat_title')[0];let chat_input=sys.getel('#chat_input')[0];let btnSend=sys.getel('#btnSend')[0];let info=sys.mySave.getsave('u');let chat_main_info=sys.getel('#chat_main_info')[0];let chat_main=sys.getel('#chat_main')[0];let btnBiaoqing=sys.getel('#biaoqing')[0];let biaoqing_box=sys.getel('#biaoqing_box')[0];let imgName=['hh','hj','jk','mg','ng','ok','ts','wx','yx','h','z','a','g','y','k','n','q','t'];let fun={};let chatStyle=oChat.style;let deviationX=0,deviationY=0,sumx=0,sumy=0;let stateDeviationX=0;let state=true;oChat_title.onmousedown=function(e){if(state){sumx+=deviationX;sumy+=deviationY;state=false;}let ev=e||event;let oldClint={sx:ev.clientX,sy:ev.clientY};let youX=sumx-oldClint.sx;let youY=sumy-oldClint.sy;fun.funMousemove=function(e){state=true;let eMove=e||event;let nowClintX=eMove.clientX;let nowClintY=eMove.clientY;if(eMove.clientX>=innerWidth-20){nowClintX=innerWidth-20}else if(eMove.clientX<=20){nowClintX=20}if(eMove.clientY>=innerHeight-20){nowClintY=innerHeight-20}else if(eMove.clientY<=20){nowClintY=20}chatStyle.transform=`translateX(${nowClintX+youX }px) translateY(${nowClintY+youY }px)`;deviationX=nowClintX-oldClint.sx;deviationY=nowClintY-oldClint.sy};doc.addEventListener('mousemove',fun.funMousemove);doc.addEventListener('mouseup',function(){doc.removeEventListener('mousemove',fun.funMousemove)})};btnCloseChat.onclick=function(){oChat.className=''};btnOpenChat.onclick=function(){btnOpenChat.className='fa fa-commenting';let setName=sys.getel('#setName')[0];info=sys.mySave.getsave('u');chat_input.focus();oChat.className='chat_show';chat_main.scrollTop=chat_main.scrollHeight;let onlineNum=sys.getel('#chat_title_onlineNum')[0];function receiveSocket(){loading_text.addEventListener('click',function(){loading_text.style.display="none"});loading_text.style.display="block";loading_text.style.opacity="1";loading_title.innerText='正在连接服务器...';loading_content.innerText=`您的昵称:${info[0]}`;let loadServer1=setTimeout(function(){loading_text.style.opacity="1";loading_text.style.display="block";loading_title.innerText='连接超时,即将重连...'},20000);let loadServer2=setTimeout(function(){loading_title.innerText='网络不佳哦,努力加载中'},5000);socket.open();socket.on('connect',function(data){if(socket.connected){console.log("连接服务器_成功 登录成功");socket.on('history',function(history){history=JSON.parse(history);if(history.length!=0){for(let i=0;i<history.length;i+=1){if(history[i].self[0]==info[0]&&history[i].self[1]==info[1]){chat_main_info.innerHTML+=`<div class="self_info">					
									<span class="self_info_name">${info[0]}</span>
									<code class="${info[1]} self_info_photo" style=""></code>	
									<span class="uesr_info_chat">${history[i].chatText }</span>
								</div>`}else{chat_main_info.innerHTML+=`<div class="other_info">				
												<span class="other_info_name">${history[i].self[0]}</span>
												<code class="${history[i].self[1]} other_info_photo" style=""></code>							
												<span class="other_info_chat">${history[i].chatText }</span>
										</div>`}}chat_main.scrollTop=chat_main.scrollHeight;setTimeout(function(){console.log('历史记录同步成功');loading_text.style.display="block";loading_text.style.opacity="1";loading_title.innerText='';loading_content.innerText=`成功同步${history.length }条历史消息`;setTimeout(function(){loading_text.style.opacity="0";setTimeout(function(){loading_text.style.display="none"},2000)},3000)},2000)}});clearTimeout(loadServer1);clearTimeout(loadServer2);loading_text.style.display="block";loading_text.style.opacity="1";loading_title.innerText='登陆中...';loading_content.innerText=`昵称:${info[0]},登陆成功`;chat_input.setAttribute('contenteditable',true);chat_input.focus();setTimeout(function(){loading_text.style.opacity="0";setTimeout(function(){loading_text.style.display="none"},2000)},1800)}});socket.on('connect_failed',function(){chat_input.setAttribute('contenteditable',false);loading_text.style.display="block";loading_text.style.opacity="1";loading_title.innerText='连接服务器失败';loading_content.innerText=``;setTimeout(function(){loading_text.style.opacity="0";setTimeout(function(){loading_text.style.display="none"},2000)},3000);socket.open();});socket.on('chat',function(receiveData){receiveData=JSON.parse(receiveData);if(receiveData.self[0]==info[0]&&receiveData.self[1]==info[1]){}else{chat_main_info.innerHTML+=`<div class="other_info">								
												<span class="other_info_name">${receiveData.self[0]}</span>
												<code class="${receiveData.self[1]} other_info_photo" style=""></code>
												<span class="other_info_chat">${receiveData.chatText }</span>
											</div>`}console.log("收到:"+JSON.stringify(receiveData));chat_main.scrollTop=chat_main.scrollHeight;if(oChat.className!='chat_show'){btnOpenChat.className='fa fa-commenting newChatInfo'}});socket.on('onlineNum',function(num){onlineNum.innerText=num});socket.on('disconnect',function(){chat_input.setAttribute('contenteditable',false);console.log('连接已断开');loading_text.style.display="block";loading_text.style.opacity="1";loading_title.innerText='连接已断开';loading_content.innerText=`请检查您的网络环境`;setTimeout(function(){setTimeout(function(){},3000)},3000)});socket.on('error',function(data){chat_input.setAttribute('contenteditable',false);console.log("连接服务器出现错误");loading_text.style.display="block";loading_text.style.opacity="1";loading_title.innerText='连接服务器出现错误';loading_content.innerText=`请检查您的网络环境哦`;setTimeout(function(){setTimeout(function(){},3000)},3000)});socket.on('reconnecting',function(num){chat_input.setAttribute('contenteditable',false);console.log('已尝试重连'+num+'次');if(num>6){socket.close();oChat.className='';loading_text.style.display="block";loading_text.style.opacity="1";loading_title.innerText='为您重连6次全部失败';loading_content.innerText=`建议更换设备或网络环境!`;setTimeout(function(){loading_text.style.opacity="0";setTimeout(function(){loading_text.style.display="none"},3000)},8000)}else{loading_text.style.display="block";loading_text.style.opacity="1";loading_title.innerText='网络不佳';loading_content.innerText=`正在进行第${ num } / 6次重连`;loading_text.style.opacity="1";loading_text.style.display="block"}})}if(info==''||info.length==0||!info){setName.style.display='block';let nowPhoto=sys.getel('#smile')[0];let sysPhoto=sys.getel('#smileList i');let btnSetName=sys.getel('#btnSetName')[0];for(let i=0;i<sysPhoto.length;i+=1){sysPhoto[i].addEventListener('click',function(){nowPhoto.className=this.className})};btnSetName.addEventListener('click',function(){let pop=new tool.FunPopup("星云提醒","确定这样设置您在线交流的昵称与头像吗?");pop.open(function(){let u=[];let name=sys.getel('#setName input')[0].value;name=name.substr(0,6);u.push(name);u.push(nowPhoto.className);sys.mySave.save('u',u);info=sys.mySave.getsave('u');setName.style.display='none';socket=io();receiveSocket();})})}else{setName.style.display='none';if(!socket){socket=io();if(!(socket.connected)){socket.open()}receiveSocket();}else{if(socket){if(socket.connected){loading_text.style.display="block";loading_text.style.opacity="1";loading_title.innerText='';loading_content.innerText=`${info[0]}已在线`;setTimeout(function(){loading_text.style.opacity="0";setTimeout(function(){loading_text.style.display="none"},2000)},1800)}}else{socket=io()}}}};function Stopenter(e){let eVent=e||event;if(eVent.keyCode==13||eVent.keyCode==86){eVent.preventDefault();}}let inputState=false;chat_input.addEventListener('compositionstart',function(){inputState=true});function funBQ(){let kuaijieBQHTML=chat_input.innerHTML;for(let im=0;im<imgName.length;im+=1){let re=new RegExp('\/'+imgName[im],"gim");kuaijieBQHTML=kuaijieBQHTML.replace(re,`<img src='img/_${imgName[im]}.png' title='${imgName[im]}'/>`);}chat_input.innerHTML=kuaijieBQHTML;if(window.getSelection){chat_input.focus();var range=window.getSelection();range.selectAllChildren(chat_input);range.collapseToEnd();}else if(document.selection){var range=document.selection.createRange();range.moveToElementText(chat_input);range.collapse(false);range.select()}}chat_input.addEventListener('input',function(){let divLength=sys.getel('#chat_input div');if(divLength.length>7){doc.addEventListener('keydown',Stopenter)}else{doc.removeEventListener('keydown',Stopenter)};if(chat_input.innerText.length>=200){chat_input.innerHTML=chat_input.innerText.substr(0,200)}if(inputState){chat_input.addEventListener('compositionend',funBQ);inputState=true;}else{funBQ()}});let biaoQing_none=null;function clickBQ(){let img=biaoqing_box.querySelectorAll('img');for(let m=0;m<img.length;m+=1){img[m].onclick=function(){chat_input.innerHTML+='/'+img[m].getAttribute('title');funBQ()}}}btnBiaoqing.addEventListener('mouseover',function(){clearTimeout(biaoQing_none);biaoqing_box.style.display='block';let img=biaoqing_box.querySelectorAll('img');let strImgTag='';if(img.length==0){for(let i=0;i<imgName.length;i+=1){strImgTag+=`<img src='img/_${imgName[i]}.png' title='${imgName[i]}'/>`}biaoqing_box.innerHTML=strImgTag}else{clickBQ()}});btnBiaoqing.addEventListener('mouseout',function(){clearTimeout(biaoQing_none);biaoQing_none=setTimeout(function(){biaoqing_box.style.display='none'},500)});btnSend.addEventListener('click',function(){let nowInputInnerHTML=chat_input.innerHTML;let sendStr=nowInputInnerHTML.substr(0,340);let sendData={self:info,chatText:sendStr};if(sendData.chatText){chat_main_info.innerHTML+=`<div class="self_info">					
							<span class="self_info_name">${sendData.self[0]}</span>
							<code class="${sendData.self[1]} self_info_photo" style=""></code>	
							<span class="uesr_info_chat">${sendData.chatText }</span>
						</div>`;chat_main.scrollTop=chat_main.scrollHeight;socket.emit('chat',sendData,function(state){if(state=='send_ok'){console.log('发送成功')}else{loading_text.style.display="block";loading_text.style.opacity="1";loading_title.innerText='发送失败';loading_content.innerText=`网络不佳哦!`;setTimeout(function(){loading_text.style.opacity="0";setTimeout(function(){loading_text.style.display="none"},1800)},1400)}})}else{if(socket.connected){loading_text.style.display="block";loading_text.style.opacity="1";loading_title.innerText='';loading_content.innerText=`请输入消息`;setTimeout(function(){loading_text.style.opacity="0";setTimeout(function(){loading_text.style.display="none"},2000)},1800)}}sendData.chatText='';chat_input.innerHTML=''})})();};